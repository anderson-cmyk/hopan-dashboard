<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard HOPAN - An√°lise de Comiss√µes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --bg-primary: #000000;
            --bg-secondary: #1C1C1E;
            --bg-tertiary: #2C2C2E;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --border: #38383A;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .master-filter {
            background: var(--bg-secondary);
            border: 2px solid var(--primary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .master-filter-label {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .master-filter select {
            flex: 1;
            min-width: 200px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .master-filter select:hover {
            border-color: var(--primary);
            background: var(--bg-secondary);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.2);
            border-color: var(--primary);
        }

        .kpi-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background: var(--bg-tertiary);
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        select, button {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        select:hover, button:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }

        button {
            background: var(--primary);
            border: none;
            font-weight: 600;
        }

        button:hover {
            background: #0051D5;
            transform: translateY(-2px);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success { background: rgba(52, 199, 89, 0.2); color: var(--success); }
        .badge-warning { background: rgba(255, 149, 0, 0.2); color: var(--warning); }
        .badge-danger { background: rgba(255, 59, 48, 0.2); color: var(--danger); }

        .pivot-table-container {
            overflow-x: auto;
        }

        .pivot-table {
            min-width: 600px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .distribution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .distribution-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
        }

        .distribution-card h4 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            font-weight: 600;
        }

        .month-analysis-table {
            overflow-x: auto;
        }

        .month-analysis-table table {
            min-width: 800px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dashboard HOPAN</h1>
            <p class="subtitle">An√°lise de Comiss√µes e Atrasos</p>
        </header>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando dados...</p>
        </div>

        <div id="content" style="display: none;">
            <!-- Filtro Master por M√™s -->
            <div class="master-filter">
                <span class="master-filter-label">üîç Filtrar por M√™s:</span>
                <select id="masterMonthFilter" onchange="applyMasterFilter()">
                    <option value="all">Todos os Meses</option>
                </select>
            </div>

            <!-- KPIs Principais -->
            <div class="kpi-grid" id="kpiGrid"></div>

            <!-- Se√ß√£o 1: An√°lise por Faixa de Atraso -->
            <div class="section">
                <h2 class="section-title">An√°lise por Faixa de Atraso</h2>
                <div class="chart-container">
                    <canvas id="faixasChart"></canvas>
                </div>
                <div id="faixasTable"></div>
            </div>

            <!-- Se√ß√£o 2: An√°lise Temporal de % Comiss√£o por M√™s -->
            <div class="section">
                <h2 class="section-title">An√°lise Temporal: % Comiss√£o por Faixa de Atraso</h2>
                <div class="month-analysis-table" id="monthAnalysisTable"></div>
            </div>

            <!-- Se√ß√£o 3: Tabela Din√¢mica -->
            <div class="section">
                <h2 class="section-title">Tabela Din√¢mica Configur√°vel</h2>
                <div class="controls">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Linha:</label>
                        <select id="pivotRow"></select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Coluna:</label>
                        <select id="pivotCol"></select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Valor:</label>
                        <select id="pivotValue"></select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Agrega√ß√£o:</label>
                        <select id="pivotAgg">
                            <option value="sum">Soma</option>
                            <option value="avg">M√©dia</option>
                            <option value="count">Contagem</option>
                            <option value="min">M√≠nimo</option>
                            <option value="max">M√°ximo</option>
                        </select>
                    </div>
                    <div style="align-self: flex-end;">
                        <button onclick="updatePivotTable()">Atualizar Tabela</button>
                    </div>
                </div>
                <div class="pivot-table-container" id="pivotTableContainer"></div>
            </div>

            <!-- Se√ß√£o 4: Distribui√ß√£o Normal de Comiss√µes -->
            <div class="section">
                <h2 class="section-title">Distribui√ß√£o de % Comiss√£o por Faixa</h2>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
                <div class="distribution-grid" id="distributionStats"></div>
            </div>
        </div>
    </div>

    <script>
        let dashboardData = null;
        let filteredData = null;
        let currentMonth = 'all';

        // Carregar dados
        async function loadData() {
            try {
                const response = await fetch('dashboard_data.json');
                dashboardData = await response.json();
                filteredData = dashboardData.dados_completos;
                initializeDashboard();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.getElementById('loading').innerHTML = '<p style="color: var(--danger);">Erro ao carregar dados. Verifique o console.</p>';
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { 
                style: 'currency', 
                currency: 'BRL' 
            }).format(value);
        }

        function formatPercent(value) {
            return value.toFixed(2) + '%';
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('pt-BR').format(value);
        }

        function initializeDashboard() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            populateMonthFilter();
            renderKPIs();
            renderFaixasAnalysis();
            renderMonthAnalysisTable();
            initializePivotTable();
            renderDistributionAnalysis();
        }

        function populateMonthFilter() {
            const select = document.getElementById('masterMonthFilter');
            const meses = dashboardData.metadados.meses_disponiveis || [];
            
            meses.forEach(mes => {
                const option = document.createElement('option');
                option.value = mes;
                option.textContent = formatMonthYear(mes);
                select.appendChild(option);
            });
        }

        function formatMonthYear(mesAno) {
            const [year, month] = mesAno.split('-');
            const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            return `${meses[parseInt(month) - 1]}/${year}`;
        }

        function applyMasterFilter() {
            currentMonth = document.getElementById('masterMonthFilter').value;
            
            if (currentMonth === 'all') {
                filteredData = dashboardData.dados_completos;
            } else {
                filteredData = dashboardData.dados_completos.filter(d => d.MesAno === currentMonth);
            }

            renderKPIs();
            renderFaixasAnalysis();
            updatePivotTable();
            renderDistributionAnalysis();
        }

        function renderKPIs() {
            const totalOps = filteredData.length;
            const totalPago = filteredData.reduce((sum, d) => sum + d.ValorPago, 0);
            const totalComissao = filteredData.reduce((sum, d) => sum + d.ValorComissao, 0);
            const percComissao = (totalComissao / totalPago * 100);

            const kpis = [
                { label: 'Total de Opera√ß√µes', value: formatNumber(totalOps), color: 'var(--primary)' },
                { label: 'Valor Total Pago', value: formatCurrency(totalPago), color: 'var(--success)' },
                { label: 'Total Comiss√µes', value: formatCurrency(totalComissao), color: 'var(--warning)' },
                { label: '% Comiss√£o Geral', value: formatPercent(percComissao), color: 'var(--secondary)' }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div class="kpi-label">${kpi.label}</div>
                    <div class="kpi-value" style="color: ${kpi.color}">${kpi.value}</div>
                </div>
            `).join('');
        }

        function renderFaixasAnalysis() {
            const faixas = {};
            const ordem = ['0-20 dias', '21-30 dias', '31-60 dias', '61-90 dias', 
                          '91-180 dias', '181-360 dias', 'Maior que 360 dias'];

            ordem.forEach(f => faixas[f] = { ops: 0, pago: 0, comissao: 0 });

            filteredData.forEach(d => {
                if (faixas[d.FaixaAtraso]) {
                    faixas[d.FaixaAtraso].ops++;
                    faixas[d.FaixaAtraso].pago += d.ValorPago;
                    faixas[d.FaixaAtraso].comissao += d.ValorComissao;
                }
            });

            const faixasArray = ordem.map(f => ({
                faixa: f,
                ops: faixas[f].ops,
                pago: faixas[f].pago,
                comissao: faixas[f].comissao,
                perc: faixas[f].pago > 0 ? (faixas[f].comissao / faixas[f].pago * 100) : 0
            }));

            // Gr√°fico
            const ctx = document.getElementById('faixasChart');
            if (window.faixasChartInstance) {
                window.faixasChartInstance.destroy();
            }

            window.faixasChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: faixasArray.map(f => f.faixa),
                    datasets: [
                        {
                            label: 'Total Pago (R$)',
                            data: faixasArray.map(f => f.pago),
                            backgroundColor: 'rgba(0, 122, 255, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Total Comiss√£o (R$)',
                            data: faixasArray.map(f => f.comissao),
                            backgroundColor: 'rgba(255, 149, 0, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: '% Comiss√£o',
                            data: faixasArray.map(f => f.perc),
                            type: 'line',
                            borderColor: 'rgba(52, 199, 89, 1)',
                            backgroundColor: 'rgba(52, 199, 89, 0.2)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#FFFFFF' }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            ticks: { color: '#8E8E93' },
                            grid: { color: '#38383A' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            ticks: { color: '#8E8E93' },
                            grid: { display: false }
                        },
                        x: {
                            ticks: { color: '#8E8E93' },
                            grid: { color: '#38383A' }
                        }
                    }
                }
            });

            // Tabela
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Faixa de Atraso</th>
                            <th>Opera√ß√µes</th>
                            <th>Total Pago</th>
                            <th>Total Comiss√£o</th>
                            <th>% Comiss√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${faixasArray.map(f => `
                            <tr>
                                <td><span class="badge ${getBadgeClass(f.faixa)}">${f.faixa}</span></td>
                                <td>${formatNumber(f.ops)}</td>
                                <td>${formatCurrency(f.pago)}</td>
                                <td>${formatCurrency(f.comissao)}</td>
                                <td>${formatPercent(f.perc)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('faixasTable').innerHTML = tableHTML;
        }

        function getBadgeClass(faixa) {
            if (faixa.includes('0-20')) return 'badge-success';
            if (faixa.includes('21-30') || faixa.includes('31-60')) return 'badge-warning';
            return 'badge-danger';
        }

        function renderMonthAnalysisTable() {
            if (!dashboardData.analise_por_mes) {
                document.getElementById('monthAnalysisTable').innerHTML = '<p>An√°lise por m√™s n√£o dispon√≠vel.</p>';
                return;
            }

            const meses = Object.keys(dashboardData.analise_por_mes).sort();
            const faixas = ['0-20 dias', '21-30 dias', '31-60 dias', '61-90 dias', 
                           '91-180 dias', '181-360 dias', 'Maior que 360 dias'];

            let tableHTML = '<table><thead><tr><th>Faixa / Estat√≠stica</th>';
            meses.forEach(mes => {
                tableHTML += `<th>${formatMonthYear(mes)}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            faixas.forEach(faixa => {
                // M√©dia
                tableHTML += `<tr><td><strong>${faixa}</strong> - M√©dia</td>`;
                meses.forEach(mes => {
                    const valor = dashboardData.analise_por_mes[mes][faixa]?.media || 0;
                    tableHTML += `<td>${formatPercent(valor)}</td>`;
                });
                tableHTML += '</tr>';

                // Mediana
                tableHTML += `<tr><td>${faixa} - Mediana</td>`;
                meses.forEach(mes => {
                    const valor = dashboardData.analise_por_mes[mes][faixa]?.mediana || 0;
                    tableHTML += `<td>${formatPercent(valor)}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            document.getElementById('monthAnalysisTable').innerHTML = tableHTML;
        }

        function initializePivotTable() {
            const camposNumericos = dashboardData.metadados.campos_numericos;
            const camposCategoricos = ['FaixaAtraso', 'FaixaValor', 'MesAno'];

            const rowSelect = document.getElementById('pivotRow');
            const colSelect = document.getElementById('pivotCol');
            const valueSelect = document.getElementById('pivotValue');

            camposCategoricos.forEach(campo => {
                rowSelect.innerHTML += `<option value="${campo}">${campo}</option>`;
                colSelect.innerHTML += `<option value="${campo}">${campo}</option>`;
            });

            camposNumericos.forEach(campo => {
                valueSelect.innerHTML += `<option value="${campo}">${campo}</option>`;
            });

            rowSelect.value = 'FaixaAtraso';
            colSelect.value = 'FaixaValor';
            valueSelect.value = 'ValorPago';

            updatePivotTable();
        }

        function updatePivotTable() {
            const rowField = document.getElementById('pivotRow').value;
            const colField = document.getElementById('pivotCol').value;
            const valueField = document.getElementById('pivotValue').value;
            const aggType = document.getElementById('pivotAgg').value;

            const data = filteredData;
            const pivot = {};
            const rowValues = new Set();
            const colValues = new Set();

            data.forEach(row => {
                const rowVal = row[rowField];
                const colVal = row[colField];
                const value = row[valueField];

                rowValues.add(rowVal);
                colValues.add(colVal);

                const key = `${rowVal}|||${colVal}`;
                if (!pivot[key]) {
                    pivot[key] = [];
                }
                pivot[key].push(value);
            });

            const aggregated = {};
            for (const key in pivot) {
                const values = pivot[key];
                let result;
                switch (aggType) {
                    case 'sum':
                        result = values.reduce((a, b) => a + b, 0);
                        break;
                    case 'avg':
                        result = values.reduce((a, b) => a + b, 0) / values.length;
                        break;
                    case 'count':
                        result = values.length;
                        break;
                    case 'min':
                        result = Math.min(...values);
                        break;
                    case 'max':
                        result = Math.max(...values);
                        break;
                }
                aggregated[key] = result;
            }

            const sortedRows = Array.from(rowValues).sort();
            const sortedCols = Array.from(colValues).sort();

            let tableHTML = '<table class="pivot-table"><thead><tr><th></th>';
            sortedCols.forEach(col => {
                tableHTML += `<th>${col}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            sortedRows.forEach(row => {
                tableHTML += `<tr><th>${row}</th>`;
                sortedCols.forEach(col => {
                    const key = `${row}|||${col}`;
                    const value = aggregated[key] || 0;
                    const formatted = valueField.includes('Valor') || valueField.includes('Comissao') || valueField.includes('Base') 
                        ? formatCurrency(value) 
                        : valueField.includes('Perc') 
                        ? formatPercent(value)
                        : formatNumber(value);
                    tableHTML += `<td>${formatted}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            document.getElementById('pivotTableContainer').innerHTML = tableHTML;
        }

        function renderDistributionAnalysis() {
            // Agrupar dados por m√™s e faixa de atraso
            const faixasPorMes = {};
            const ordem = ['0-20 dias', '21-30 dias', '31-60 dias', '61-90 dias', 
                          '91-180 dias', '181-360 dias', 'Maior que 360 dias'];
            
            const meses = dashboardData.metadados.meses_disponiveis || [];

            // Inicializar estrutura
            meses.forEach(mes => {
                faixasPorMes[mes] = {};
                ordem.forEach(f => faixasPorMes[mes][f] = []);
            });

            // Preencher dados
            filteredData.forEach(d => {
                if (faixasPorMes[d.MesAno] && faixasPorMes[d.MesAno][d.FaixaAtraso]) {
                    faixasPorMes[d.MesAno][d.FaixaAtraso].push(d.PercComissao);
                }
            });

            // Remover gr√°fico (n√£o ser√° mais usado)
            const chartContainer = document.getElementById('distributionChart').parentElement;
            chartContainer.style.display = 'none';

            // Criar tabela de estat√≠sticas por m√™s
            let statsHTML = '<div style="overflow-x: auto;"><table><thead><tr><th>Faixa de Atraso</th><th>Estat√≠stica</th>';
            
            meses.forEach(mes => {
                statsHTML += `<th>${formatMonthYear(mes)}</th>`;
            });
            statsHTML += '</tr></thead><tbody>';

            ordem.forEach(faixa => {
                // Linha de M√©dia
                statsHTML += `<tr><td rowspan="5"><strong>${faixa}</strong></td><td>M√©dia</td>`;
                meses.forEach(mes => {
                    const valores = faixasPorMes[mes][faixa];
                    if (valores.length > 0) {
                        const media = valores.reduce((a, b) => a + b, 0) / valores.length;
                        statsHTML += `<td>${formatPercent(media)}</td>`;
                    } else {
                        statsHTML += `<td>-</td>`;
                    }
                });
                statsHTML += '</tr>';

                // Linha de Mediana
                statsHTML += `<tr><td>Mediana</td>`;
                meses.forEach(mes => {
                    const valores = faixasPorMes[mes][faixa];
                    if (valores.length > 0) {
                        const sorted = [...valores].sort((a, b) => a - b);
                        const mediana = sorted[Math.floor(sorted.length / 2)];
                        statsHTML += `<td>${formatPercent(mediana)}</td>`;
                    } else {
                        statsHTML += `<td>-</td>`;
                    }
                });
                statsHTML += '</tr>';

                // Linha de M√≠nimo
                statsHTML += `<tr><td>M√≠nimo</td>`;
                meses.forEach(mes => {
                    const valores = faixasPorMes[mes][faixa];
                    if (valores.length > 0) {
                        const min = Math.min(...valores);
                        statsHTML += `<td>${formatPercent(min)}</td>`;
                    } else {
                        statsHTML += `<td>-</td>`;
                    }
                });
                statsHTML += '</tr>';

                // Linha de M√°ximo
                statsHTML += `<tr><td>M√°ximo</td>`;
                meses.forEach(mes => {
                    const valores = faixasPorMes[mes][faixa];
                    if (valores.length > 0) {
                        const max = Math.max(...valores);
                        statsHTML += `<td>${formatPercent(max)}</td>`;
                    } else {
                        statsHTML += `<td>-</td>`;
                    }
                });
                statsHTML += '</tr>';

                // Linha de Desvio Padr√£o
                statsHTML += `<tr><td>Desvio Padr√£o</td>`;
                meses.forEach(mes => {
                    const valores = faixasPorMes[mes][faixa];
                    if (valores.length > 0) {
                        const media = valores.reduce((a, b) => a + b, 0) / valores.length;
                        const std = Math.sqrt(valores.reduce((sum, val) => sum + Math.pow(val - media, 2), 0) / valores.length);
                        statsHTML += `<td>${formatPercent(std)}</td>`;
                    } else {
                        statsHTML += `<td>-</td>`;
                    }
                });
                statsHTML += '</tr>';
            });

            statsHTML += '</tbody></table></div>';
            document.getElementById('distributionStats').innerHTML = statsHTML;
        }

        function createHistogramData(values) {
            const bins = [0, 2, 4, 6, 8, 10, 12, 15, Infinity];
            const counts = new Array(bins.length - 1).fill(0);

            values.forEach(val => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (val >= bins[i] && val < bins[i + 1]) {
                        counts[i]++;
                        break;
                    }
                }
            });

            return counts;
        }

        window.addEventListener('load', loadData);
    </script>
</body>
</html>
